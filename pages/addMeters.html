<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>添加电表</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui.2.0.css" />
    <link rel="stylesheet" type="text/css" href="../css/common.css" />
    <style>
        html,
        body {
            padding: 0px;
            margin: 0px;
            width: 100%;
            height: 100%;
            background: #ffffff;
        }

        .aui-bar.aui-bar-nav.aui-row {
            color: #ffffff;
            background: rgb(45, 140, 240)!important;
            border: none;
        }

        .aui-bar-nav .aui-btn .aui-iconfont {
            color: #fff;
        }

        .aui-content {}

        .red {
            color: red;
        }

        .aui-list .aui-list-item {
            /*border-bottom:0.05rem solid #dddddd;*/
        }

        .aui-list .aui-list-item input,
        .aui-list .aui-list-item select {
            min-height: 1.8rem;
            background-color: rgb(234, 234, 234);
            color: #000000;
            border-radius: 8px;
            font-size: 0.7rem;
            text-indent: 6px;
        }

        input::-webkit-input-placeholder {
            color: #999;
        }

        input::-moz-placeholder {
            /* Mozilla Firefox 19+ */
            color: #999;
        }

        input:-moz-placeholder {
            /* Mozilla Firefox 4 to 18 */
            color: #999;
        }

        input:-ms-input-placeholder {
            /* Internet Explorer 10-11 */
            color: #999;
        }

        button,
        .aui-btn {
            padding: 0.27rem 1.1rem;
            color: #ffffff;
        }

        .aui-btn.submit {
            background: rgb(45, 140, 240);
        }

        .aui-btn.cancel {
            background: red;
        }
    </style>
</head>

<body>
    <header class="aui-bar aui-bar-nav aui-row">
        <div class="aui-pull-left aui-btn" onclick="turnBack()" tapmode>
            <i class="aui-iconfont aui-icon-left"></i>
        </div>
        <div class="aui-title">添加电表</div>
    </header>
    <div class="aui-content aui-margin-b-15">
        <ul class="aui-list aui-form-list">
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>电表编号:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id="mid" placeholder="请输入电表编号">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>小区名称:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='location_name' placeholder="请输入小区名称">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>设备秘钥:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='mkeys' placeholder="请输入设备秘钥">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>用户编号:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='usercode' placeholder="请输入用户编号">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>用户名称:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='username' placeholder="请输入用户名称">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>手机号码:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='phonenumber' placeholder="请输入手机号码">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>电表类型:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='meter_type' placeholder="请输入电表类型">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>用户类型:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='type' placeholder="请输入用户类型">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>变比:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='ratio' placeholder="请输入变比">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>设备状态:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='status' placeholder="请输入设备状态">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>设备单价:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='price' placeholder="请输入设备单价">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label">
                        <span class="red">*</span>电表初值:
                    </div>
                    <div class="aui-list-item-input">
                        <input type="text" id='initval' placeholder="请输入电表初值">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner aui-list-item-center aui-list-item-btn">
                    <div class="aui-btn aui-margin-r-5 cancel">取消</div>
                    <div class="aui-btn aui-margin-l-5 submit" onclick='addMeter()'>提交</div>
                </div>
            </li>
        </ul>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/aui-dialog.js"></script>
<script type="text/javascript" src="../script/aui-toast.js"></script>
<script type="text/javascript">
    apiready = function() {

    };
    //根据电表表号获取电表详情
    function getMeterDetailByMid() {
        var mid = $("#mid").val();
        if (mid) {
            $.ajax({
                type: 'get',
                data: {
                    mid: mid
                },
                url: HEADER + 'app/meter/check_getMeterDetailByMid.do',
                success: function(data) {
                  console.log(JSON.stringify(data));
                    if (data.data!=null&&data.code == 1) {
                      console.log(">>>>>>>>>>>>>>>i");
                        initInputValue(data.data)
                    } else {
                      api.alert({
                          title: "提示信息",
                          msg: "电表不存在!"
                      });
                    }
                }
            })
        } else {
            api.alert({
                title: "提示信息",
                msg: "请先输入电表编号后添加电表!"
            });
        }
    }
    //绑定数据在inputs框中
    function initInputValue(data) {
        $("#location_name").val(data.location_name);
        $("#mkeys").val(data.mkeys);
        $("#usercode").val(data.usercode);
        $("#username").val(data.username);
        $("#phonenumber").val(data.phonenumber);
        $("#meter_type").val(data.meter_type);
        $("#type").val(data.type);
        $("#ratio").val(data.ratio);
        $("#status").val(data.status);
        $("#price").val(data.price);
        $("#initval").val(data.initval);
    }
    //添加电表
    function addMeter() {
        var mid = $("#mid").val();
        $.ajax({
            type: 'post',
            data: {
                mid: mid
            },
            url: HEADER + '/app/meter/add_addMeter.do',
            success: function(data) {
                if (data.code == 1) {
                    api.alert({
                        title: "提示信息",
                        msg: "添加成功!"
                    })
                } else {
                    api.alert({
                        title: "提示信息",
                        msg: data.msg
                    })
                }
            }
        })
    }
    // 返回上一页
    function turnBack() {
        api.sendEvent({
            name: 'addMeters'
        });
        api.closeWin();
    }

    $("input:not('#mid')").prop('disabled', true); //除了电表编号都禁止输入

    //电表编号的值变化就去请求
    $('#mid').on('blur', function() {
        getMeterDetailByMid();
    });
</script>1

</html>
